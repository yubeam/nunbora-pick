<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>익명 채택</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .postit-board {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .postit {
      width: 200px;
      height: 200px;
      padding: 15px;
      border: 2px solid #ddd;
      box-shadow: 3px 3px 5px rgba(0,0,0,0.1);
      font-size: 14px;
      white-space: pre-wrap;
      cursor: pointer;
    }
    .postit.selected {
      outline: 3px solid black;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h1>자기소개 채택</h1>
    <p id="infoText">자기소개를 클릭해서 채택하세요 (2명까지)</p>
    <div class="postit-board" id="board"></div>
    <button onclick="finish()" id="finishBtn" style="display:none;">채택 완료</button>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || user.role !== "selector") {
      alert("접근 권한이 없습니다.");
      location.href = "index.html";
    }

    const introData = JSON.parse(localStorage.getItem("introductions") || "[]");
    if (introData.length < 4) {
      alert("아직 모든 자기소개가 등록되지 않았습니다.");
      location.href = "index.html";
    }

    const selections = JSON.parse(localStorage.getItem("selections") || "{}");
    const myPicks = selections[user.name] || [];

    const board = document.getElementById("board");
    const finishBtn = document.getElementById("finishBtn");

    function render() {
      board.innerHTML = "";
      introData.forEach((post, i) => {
        const div = document.createElement("div");
        div.className = "postit";
        div.style.backgroundColor = post.color;
        div.textContent = post.text;

        // 익명 처리
        div.onclick = () => toggleSelect(i, post.writer);

        if (myPicks.includes(post.writer)) {
          div.classList.add("selected");
        }

        board.appendChild(div);
      });
      finishBtn.style.display = myPicks.length === 2 ? "block" : "none";
    }

    function toggleSelect(index, writer) {
      if (myPicks.includes(writer)) {
        const idx = myPicks.indexOf(writer);
        myPicks.splice(idx, 1);
      } else {
        if (myPicks.length >= 2) {
          alert("2명까지만 선택할 수 있어요.");
          return;
        }
        // 이미 다른 selector가 선택했는지 확인
        const otherSelector = user.name === "김태우" ? "이경민" : "김태우";
        const otherPicks = selections[otherSelector] || [];
        if (otherPicks.includes(writer)) {
          alert("이미 다른 사람이 채택한 사람입니다.");
          return;
        }
        myPicks.push(writer);
      }
      selections[user.name] = myPicks;
      localStorage.setItem("selections", JSON.stringify(selections));
      render();
    }

    function finish() {
      alert("채택이 완료되었습니다!");
      location.href = "index.html";
    }

    render();
  </script>
</body>
</html>
