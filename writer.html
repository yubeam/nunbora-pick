<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자기소개 작성</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .postit-board {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .postit {
      width: 200px;
      height: 200px;
      padding: 15px;
      background-color: #fffc9e;
      border: 2px solid #ddd;
      box-shadow: 3px 3px 5px rgba(0,0,0,0.1);
      font-size: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h1>자기소개 작성</h1>
    <textarea id="intro" rows="8" cols="30" placeholder="여기에 자기소개를 써주세요"></textarea>
    <button onclick="submitIntro()">등록</button>
    <div id="done" style="display:none; margin-top:20px;">
      <p>자기소개가 등록되었습니다!</p>
      <div class="postit-board" id="board"></div>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || user.role !== "writer") {
      alert("접근 권한이 없습니다.");
      location.href = "index.html";
    }

    function submitIntro() {
      const text = document.getElementById("intro").value.trim();
      if (text === "") {
        alert("내용을 입력하세요.");
        return;
      }

      // 랜덤 색상
      const colors = ["#fffc9e", "#caffbf", "#ffd6a5", "#9bf6ff"];
      const myColor = colors[Math.floor(Math.random() * colors.length)];

      const intro = {
        text,
        color: myColor,
        writer: user.name
      };

      const saved = JSON.parse(localStorage.getItem("introductions") || "[]");
      saved.push(intro);
      localStorage.setItem("introductions", JSON.stringify(saved));

      document.getElementById("intro").style.display = "none";
      document.querySelector("button").style.display = "none";
      document.getElementById("done").style.display = "block";

      showPosts(saved);
    }

    function showPosts(data) {
      const board = document.getElementById("board");
      board.innerHTML = "";
      data.forEach(post => {
        const div = document.createElement("div");
        div.className = "postit";
        div.style.backgroundColor = post.color;
        div.textContent = post.text;
        board.appendChild(div);
      });
    }

    // 이미 작성했으면 보여주기
    const intros = JSON.parse(localStorage.getItem("introductions") || "[]");
    if (intros.find(p => p.writer === user.name)) {
      document.getElementById("intro").style.display = "none";
      document.querySelector("button").style.display = "none";
      document.getElementById("done").style.display = "block";
      showPosts(intros);
    }
  </script>
</body>
</html>
